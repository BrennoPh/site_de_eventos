<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Comprar Ingressos</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .botoes-acao { display: flex; gap: 1rem; margin-top: 2rem; }
        .botoes-acao button { flex-grow: 1; }
    </style>
</head>
<body>
<div class="pedido-container">
    <div class="evento-detalhe" th:if="${evento}">
        <img th:src="${evento.imageUrl != null ? evento.imageUrl : 'https://source.unsplash.com/random/800x400/?party,concert'}" alt="Imagem do Evento" style="width:100%; height:auto; border-radius: 8px;">
        <h1 th:text="${evento.nomeEvento}">Nome do Evento</h1>
        <p class="meta-info">
            <span th:text="${#temporals.format(evento.dataEvento, 'dd MMM yyyy')}">Data</span> |
            <span th:text="${evento.local}">Local</span>
        </p>
    </div>

    <div class="resumo-pedido">
        <h3>Seu Pedido</h3>

        <form id="form-pedido" method="POST">
            <input type="hidden" name="eventoId" th:value="${evento.idEvento}" />
            
            <div class="form-group">
                <label for="quantidade">Quantidade de Ingressos</label>
                <input type="number" id="quantidade" name="quantidade" min="1" 
                       th:max="${evento.ingressosDisponiveis}" required 
                       th:value="${quantidadeAtual}"> </div>
            
            <div class="form-group" style="margin-top: 1rem;">
                <label for="cupomCode">Cupom de Desconto</label>
                <input type="text" id="cupomCode" name="cupomCode" placeholder="Digite seu cupom"
                       th:value="${cupomAtual}"> </div>

            <div id="resumo-servidor" style="margin: 1.5rem 0;" th:if="${valorTotal != null}">
                <p class="resumo-linha"><span>Ingressos</span> <span th:text="${#numbers.formatCurrency(valorIngressos)}"></span></p>
                <p class="resumo-linha"><span>Taxa de Serviço</span> <span th:text="${#numbers.formatCurrency(valorTaxa)}"></span></p>
                
                <div th:if="${descontoAplicado > 0}">
                    <p class="resumo-linha" style="color: #2ecc71;"><span>Desconto</span> <span th:text="|- ${#numbers.formatCurrency(descontoAplicado)}|"></span></p>
                </div>
                
                <div th:if="${cupomValido != null}">
                    <p th:if="${cupomValido}" style="color: #2ecc71; text-align: center;">Cupom aplicado com sucesso!</p>
                    <p th:unless="${cupomValido}" style="color: #e74c3c; text-align: center;">Cupom inválido.</p>
                </div>

                <hr style="border-color: var(--border); margin: 1rem 0;">
                <p class="resumo-linha resumo-total"><span>TOTAL</span> <span th:text="${#numbers.formatCurrency(valorTotal)}"></span></p>
            </div>
            
            <div class="botoes-acao">
                <button type="submit" formaction="/pedidos/calcular" class="btn-neutral">Atualizar Total</button>
                
                <button type="submit" formaction="/pedidos" class="btn-accent">Próxima Etapa</button>
            </div>
        </form>
    </div>
</div>
</body>
</html>